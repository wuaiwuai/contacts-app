"use strict";var contactsApp=angular.module("contactsApp",["contactsControllers","ui.router","contactsServices"]),DIR="/static/partials";contactsApp.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,c){c.html5Mode(!0),t.state("login",{url:"/login",templateUrl:DIR+"/login.html",controller:"LoginCtrl"}).state("register",{url:"/register",templateUrl:DIR+"/register.html",controller:"RegisterCtrl"}).state("home",{url:"/",templateUrl:DIR+"/home.html",controller:"HomeCtrl",resolve:{contactsObj:function(t){var e=t.getContacts().then(function(t){return t});return e}}}).state("home.add",{url:"add",templateUrl:DIR+"/home.add.html",controller:"HomeCtrl"}).state("home.contact",{url:"contact/:contact",templateUrl:DIR+"/home.contact.html",controller:"HomeCtrl"}).state("home.update",{url:"contact/:contact/update",templateUrl:DIR+"/home.update.html",controller:"HomeCtrl"}),e.otherwise("login")}]),contactsApp.run(["$rootScope","AuthService","$location","FlashService","$state",function(t,e,c,n,o){t.$state=o,t.flash=n;var s=["/login","/register"];t.$on("$locationChangeStart",function(){s.indexOf(c.path())<0&&!e.getCurrentUser()&&c.path("/login")})}]);var contactsControllers=angular.module("contactsControllers",[]);contactsControllers.controller("LoginCtrl",["$scope","AuthService","$location",function(t,e,c){t.credentials={},t.login=function(){e.login(t.credentials).success(function(){c.path("/")})}}]),contactsControllers.controller("RegisterCtrl",["$scope","RegisterService","$location",function(t,e,c){t.credentials={},t.register=function(){e.registerUser(t.credentials).success(function(){c.path("/login")})}}]),contactsControllers.controller("HomeCtrl",["$scope","AuthService","$location","DataService","$stateParams","contactsObj",function(t,e,c,n,o,s){t.newContact={},t.user=e.getCurrentUser(),t.contacts=s;for(var a=0,r=t.contacts.length;r>a;a++)if(t.contacts[a].firstName+"-"+t.contacts[a].lastName==o.contact){t.contact=t.contacts[a];break}n.getTags().then(function(e){t.tags=e}),t.addContact=function(){n.addContact(t.newContact).success(function(){c.path("/contact/"+t.newContact.firstName+"-"+t.newContact.lastName)})},t.updateContact=function(){n.updateContact(t.contact.id,t.contact).success(function(){c.path("/contact/"+t.contact.firstName+"-"+t.contact.lastName)})},t.deleteContact=function(){n.deleteContact(t.contact.id).success(function(){c.path("/")})},t.logout=function(){e.logout().success(function(){c.path("/login")})}}]);var contactsServices=angular.module("contactsServices",[]);contactsServices.factory("FlashService",["$rootScope",function(t){var e=[],c="";return t.$on("$locationChangeSuccess",function(){c=e.shift()||""}),{setMessage:function(t){e.push(t)},showMessage:function(t){c=t},getMessage:function(){return c}}}]),contactsServices.factory("AuthService",["SessionService","$http","FlashService","CacheService",function(t,e,c,n){var o=function(e){t.set("user",e)},s=function(){t.unset("user")};return{login:function(t){var s=e.post("/auth/login",t);return s.success(function(t){o(t.user),n.put("contacts",t.contacts),n.put("tags",t.tags)}),s.error(function(t){c.showMessage(t.message)}),s},logout:function(){var t=e.get("/auth/logout");return t.success(function(t){s(),c.setMessage(t.message)}),t},getCurrentUser:function(){return t.get("user")}}}]),contactsServices.factory("DataService",["$http","CacheService","$q","AuthService","FlashService",function(t,e,c,n,o){var s=n.getCurrentUser(),a=function(t){var c=e.get("contacts");c.push(t),e.put("contacts",c)},r=function(t,c){for(var n=e.get("contacts"),o=0,s=n.length;s>o;o++)n[o]==t&&(n[o]=c);e.put("contacts",n)},u=function(t){for(var c=e.get("contacts"),n=0,o=c.length;o>n;n++)c[n].id==t&&c.splice(n,1);e.put("contacts",c)},i=function(t){var c=e.get("tags");c.push(t),e.put("tags",cachedTags)};return{getContacts:function(){if(e.get("contacts"))return c.when(e.get("contacts"));var n=t.get("/api/users/"+s+"/contacts").then(function(t){return e.put("contacts",t.data.contacts),t.data.contacts});return n},addContact:function(e){var c=t.post("/api/users/"+s+"/contacts",e);return c.success(function(t){a(t.contact),o.setMessage(t.message)}),c.error(function(t){o.showMessage(t.message)}),c},updateContact:function(e,c){var n=t.put("/api/users/"+s+"/contacts/"+e,c);return n.success(function(t){r(e,t.contact),o.setMessage(t.message)}),n.error(function(t){o.showMessage(t.message)}),n},deleteContact:function(e){var c=t.delete("/api/users/"+s+"/contacts/"+e);return c.success(function(t){u(e),o.setMessage(t.message)}),c.error(function(t){o.showMessage(t.message)}),c},getTags:function(){if(e.get("tags"))return c.when(e.get("tags"));var n=t.get("/api/users/"+s+"/tags").then(function(t){return e.put("tags",t.data.tags),t.data.tags});return n},addTag:function(e){var c=t.post("/api/users/"+s+"/tags",e);return c.success(function(t){i(e),o.setMessage(t.message)}),contact.error(function(t){o.showMessage(t.message)}),c}}}]),contactsServices.factory("CacheService",["$cacheFactory",function(t){return t("customData")}]),contactsServices.factory("RegisterService",["$http","FlashService",function(t,e){return{registerUser:function(c){var n=t.post("/api/users",c);return n.success(function(t){e.setMessage(t.message)}),n.error(function(t){e.showMessage(t.message)}),n}}}]),contactsServices.factory("SessionService",[function(){return{get:function(t){return localStorage.getItem(t)},set:function(t,e){return localStorage.setItem(t,e)},unset:function(t){return localStorage.removeItem(t)}}}]);