var contactsApp=angular.module("contactsApp",["ui.router","authModule","flashModule","homeModule","loginModule","registerModule"]),authModule=angular.module("authModule",[]),flashModule=angular.module("flashModule",[]),homeModule=angular.module("homeModule",[]),loginModule=angular.module("loginModule",[]),registerModule=angular.module("registerModule",[]),DIR="/static/partials";contactsApp.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,o){o.html5Mode(!0),t.state("login",{url:"/login",templateUrl:DIR+"/login.html",controller:"LoginCtrl"}).state("register",{url:"/register",templateUrl:DIR+"/register.html",controller:"RegisterCtrl"}).state("home",{url:"/",templateUrl:DIR+"/home.html",controller:"HomeCtrl",resolve:{contactsObj:function(t){var e=t.getContacts().then(function(t){return t});return e}}}).state("home.add",{url:"add",templateUrl:DIR+"/home.add.html",controller:"HomeCtrl"}).state("home.contact",{url:"contact/:contact",templateUrl:DIR+"/home.contact.html",controller:"HomeCtrl"}).state("home.update",{url:"contact/:contact/update",templateUrl:DIR+"/home.update.html",controller:"HomeCtrl"}),e.otherwise("login")}]),contactsApp.run(["$rootScope","AuthService","$location","FlashService","$state",function(t,e,o,n,c){t.$state=c,t.flash=n;var a=["/login","/register"];t.$on("$locationChangeStart",function(){a.indexOf(o.path())<0&&!e.getCurrentUser()&&o.path("/login")})}]),authModule.factory("AuthService",["SessionService","$http","FlashService","CacheService",function(t,e,o,n){var c=function(e){t.set("user",e)},a=function(){t.unset("user")};return{login:function(t){var a=e.post("/auth/login",t);return a.success(function(t){c(t.user),n.put("contacts",t.contacts),n.put("tags",t.tags)}),a.error(function(t){o.showMessage(t.message)}),a},logout:function(){var t=e.get("/auth/logout");return t.success(function(t){a(),o.setMessage(t.message)}),t},getCurrentUser:function(){return t.get("user")}}}]),authModule.factory("SessionService",[function(){return{get:function(t){return localStorage.getItem(t)},set:function(t,e){return localStorage.setItem(t,e)},unset:function(t){return localStorage.removeItem(t)}}}]),flashModule.factory("FlashService",["$rootScope",function(t){var e=[],o="";return t.$on("$locationChangeSuccess",function(){o=e.shift()||""}),{setMessage:function(t){e.push(t)},showMessage:function(t){o=t},getMessage:function(){return o}}}]),homeModule.factory("CacheService",["$cacheFactory",function(t){return t("customData")}]),homeModule.factory("DataService",["$http","CacheService","$q","AuthService","FlashService",function(t,e,o,n,c){var a=n.getCurrentUser(),s=function(t){var o=e.get("contacts");o.push(t),e.put("contacts",o)},r=function(t,o){for(var n=e.get("contacts"),c=0,a=n.length;a>c;c++)n[c]==t&&(n[c]=o);e.put("contacts",n)},u=function(t){for(var o=e.get("contacts"),n=0,c=o.length;c>n;n++)o[n].id==t&&o.splice(n,1);e.put("contacts",o)},i=function(t){var o=e.get("tags");o.push(t),e.put("tags",cachedTags)};return{getContacts:function(){if(e.get("contacts"))return o.when(e.get("contacts"));var n=t.get("/api/users/"+a+"/contacts").then(function(t){return e.put("contacts",t.data.contacts),t.data.contacts});return n},addContact:function(e){var o=t.post("/api/users/"+a+"/contacts",e);return o.success(function(t){s(t.contact),c.setMessage(t.message)}),o.error(function(t){c.showMessage(t.message)}),o},updateContact:function(e,o){var n=t.put("/api/users/"+a+"/contacts/"+e,o);return n.success(function(t){r(e,t.contact),c.setMessage(t.message)}),n.error(function(t){c.showMessage(t.message)}),n},deleteContact:function(e){var o=t.delete("/api/users/"+a+"/contacts/"+e);return o.success(function(t){u(e),c.setMessage(t.message)}),o.error(function(t){c.showMessage(t.message)}),o},getTags:function(){if(e.get("tags"))return o.when(e.get("tags"));var n=t.get("/api/users/"+a+"/tags").then(function(t){return e.put("tags",t.data.tags),t.data.tags});return n},addTag:function(e){var o=t.post("/api/users/"+a+"/tags",e);return o.success(function(t){i(e),c.setMessage(t.message)}),contact.error(function(t){c.showMessage(t.message)}),o}}}]),homeModule.controller("HomeCtrl",["$scope","AuthService","$location","DataService","$stateParams","contactsObj",function(t,e,o,n,c,a){t.newContact={},t.user=e.getCurrentUser(),t.contacts=a;for(var s=0,r=t.contacts.length;r>s;s++)if(t.contacts[s].firstName+"-"+t.contacts[s].lastName==c.contact){t.contact=t.contacts[s];break}n.getTags().then(function(e){t.tags=e}),t.addContact=function(){n.addContact(t.newContact).success(function(){o.path("/contact/"+t.newContact.firstName+"-"+t.newContact.lastName)})},t.updateContact=function(){n.updateContact(t.contact.id,t.contact).success(function(){o.path("/contact/"+t.contact.firstName+"-"+t.contact.lastName)})},t.deleteContact=function(){n.deleteContact(t.contact.id).success(function(){o.path("/")})},t.logout=function(){e.logout().success(function(){o.path("/login")})}}]),loginModule.controller("LoginCtrl",["$scope","AuthService","$location",function(t,e,o){t.credentials={},t.login=function(){e.login(t.credentials).success(function(){o.path("/")})}}]),registerModule.controller("RegisterCtrl",["$scope","RegisterService","$location",function(t,e,o){t.credentials={},t.register=function(){e.registerUser(t.credentials).success(function(){o.path("/login")})}}]),registerModule.factory("RegisterService",["$http","FlashService",function(t,e){return{registerUser:function(o){var n=t.post("/api/users",o);return n.success(function(t){e.setMessage(t.message)}),n.error(function(t){e.showMessage(t.message)}),n}}}]);